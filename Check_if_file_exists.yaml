- defaultTab: output
  description: ''
  executionEnabled: true
  group: Customer
  id: 6d8fc430-9faa-4738-87f0-62396e2db89f
  loglevel: INFO
  name: Check if file exists
  nodeFilterEditable: false
  options:
  - hidden: true
    label: file_doesnt_exist
    name: file_doesnt_exist
    value: 'NO'
  - hidden: true
    label: file_exists
    name: file_exists
    value: 'YES'
  - label: filename
    name: filename
  plugins:
    ExecutionLifecycle: {}
  runnerSelector:
    filter: RUNNER5_0
    runnerFilterMode: TAGS
    runnerFilterType: TAG_FILTER_AND
  scheduleEnabled: true
  schedules: []
  sequence:
    commands:
    - args: ${option.filename}
      autoSecureInput: 'false'
      description: Check for existing inventory.csv file
      passSecureInput: 'false'
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            regex: ^RUNDECK:DATA:\s*([^\s]+?)\s*=\s*(.+)$
            replaceFilteredResult: 'false'
          type: key-value-data
      script: |
        #!/bin/bash

        directory="/home/ubuntu/Inventory"
        filename="$1"

        filepath="$directory/$filename"

        if [ -f "$filepath" ]; then
          echo "Yes: file '$filename' exists in '$directory'."
          echo "Is the file here: " @option.file_exists@
          echo "RUNDECK:DATA: inventorycsv = YES"
        else
          echo "No: file '$filename' does not exist in '$directory'."
          echo "Is the file here now: " @option.file_doesnt_exist@
          echo "RUNDECK:DATA: inventorycsv = NO"
        fi
    - configuration:
        export: inventorycsv
        group: export
        value: ${data.inventorycsv*}
      nodeStep: false
      type: export-var
    - exec: 'echo "file exists: ${export.inventorycsv}"'
    - exec: 'echo "file doesnt exist: ${export.inventorycsv}"'
    - configuration:
        assignmentGroup: MIM Support
        caller: RBA Framework Result
        description: Please address the issue of inventory.csv not currently residing
          in /home/ubuntu/inventory directory
        impact: 1 - High
        login: admin
        password-key-storage-path: keys/project/PDT-maravopoulos/SNOW_Creds
        priority: 2 - High
        shortDescription: ${option.filename} file does not exist in directory
        urgency: 2 - Medium
        url: https://dev278679.service-now.com/
      description: Create a ServiceNow incident
      nodeStep: false
      type: Service-Now-Incident-Create
    keepgoing: false
    pluginConfig:
      WorkflowStrategy:
        ruleset:
          rules: |
            [1] run-at-start
            [2] run-after:1
            [3] run-after:2
            [4] run-after:2
            [5] run-after:4

            # Autogenerated Conditions
            [3] if:export.inventorycsv==YES
            [4-5] if:export.inventorycsv!=YES
    strategy: ruleset
  tags: servicenow
  uuid: 6d8fc430-9faa-4738-87f0-62396e2db89f

